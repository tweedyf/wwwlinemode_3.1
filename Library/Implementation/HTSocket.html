<HTML>
<HEAD>
<TITLE>Manages Read and Write to and from the Network</TITLE>
<NEXTID N="z18">
</HEAD>
<BODY>

<H1>Manages Read and Write to and from the Network</H1>

<PRE>
/*
**	(c) COPYRIGHT MIT 1995.
**	Please first read the full copyright statement in the file COPYRIGH.
*/
</PRE>

This module defines the read and write functions to and from the
network. As we are having reentrant function and a smarter network I/O
this will get very small :-) <P>

This module is implemented by <A HREF="HTSocket.c">HTSocket.c</A>, and
it is a part of the <A NAME="z10"
HREF="http://www.w3.org/hypertext/WWW/Library/">
W3C Reference Library</A>.

<PRE>
#ifndef HTSOCKET_H
#define HTSOCKET_H

#include <A HREF="HTAccess.html">"HTAccess.h"</A>
#include <A HREF="HTStream.html">"HTStream.h"</A>
#include <A HREF="HTAnchor.html">"HTAnchor.h"</A>
</PRE>

<H2>Create an Input Buffer</H2>

This function allocates a input buffer and binds it to the socket
descriptor given as parameter.

<PRE>
extern HTInputSocket* HTInputSocket_new PARAMS((SOCKFD file_number));
</PRE>

<H2>Free an Input Buffer</H2>

<PRE>
extern void HTInputSocket_free PARAMS((HTInputSocket * isoc));
</PRE>

<A NAME="Read"><H2>Read Data from a Socket</H2></A>

This function has replaced many other functions for doing read from a
socket. It automaticly converts from ASCII if we are on a NON-ASCII
machine. This assumes that we do <B>not</B> use this function to read
a local file on a NON-ASCII machine. The following type definition is
to make life easier when having a state machine looking for a
<CODE>&lt;CRLF&gt;</CODE> sequence.

<PRE>
typedef enum _HTSocketEOL {
    EOL_ERR = -1,
    EOL_BEGIN = 0,
    EOL_FCR,
    EOL_FLF,
    EOL_DOT,
    EOL_SCR,
    EOL_SLF
} HTSocketEOL;

extern int HTSocketRead	PARAMS((HTRequest * request, HTStream * target));
</PRE>

<H2>Read from an ANSI file Descriptor</H2>

This function has replaced the HTParseFile() and HTFileCopy functions
for read from an ANSI file descriptor.

<PRE>
extern int HTFileRead	PARAMS((FILE * fp, HTRequest * request,
				HTStream * target));
</PRE>

<HR>

<B><IMG ALIGN=middle SRC="http://www.w3.org/hypertext/WWW/Icons/32x32/caution.gif"> THE REST OF THE FUNCTION DEFINED IN THIS MODULE ARE GOING TO BE
OBSOLETE SO DO NOT USE THEM - THEY ARE NOT REENTRANT. </B>

<HR>

<H2><A
NAME="z1">HTCopy:  Copy a socket to a stream</A></H2>This is used by the protocol engines
to send data down a stream, typically
one which has been generated by HTStreamStack.
Returns the number of bytes transferred.

<PRE>
extern int HTCopy	PARAMS((SOCKFD		file_number,
				HTStream *	sink));
</PRE>

<H2><A
NAME="c6">HTFileCopy:  Copy a file to a stream</A></H2>This is used by the protocol engines
to send data down a stream, typically
one which has been generated by HTStreamStack.
It is currently called by <A
NAME="z9" HREF="#c7">HTParseFile</A>
<PRE>
extern void HTFileCopy PARAMS((
	FILE*			fp,
	HTStream*		sink));
</PRE>
<H2><A
NAME="c2">HTCopyNoCR: Copy a socket to a stream,
stripping CR characters.</A></H2>It is slower than <A
NAME="z2" HREF="#z1">HTCopy</A> .
<PRE>
extern void HTCopyNoCR PARAMS((
	SOCKFD			file_number,
	HTStream*		sink));


</PRE>
<H2>HTParseSocket: Parse a socket given
its format</H2>This routine is called by protocol
modules to load an object.  uses<A
NAME="z4" HREF="#z3">
HTStreamStack</A> and the copy routines
above.  Returns HT_LOADED if succesful,
&lt;0 if not.
<PRE>extern int HTParseSocket PARAMS((
	HTFormat	format_in,
	SOCKFD 		file_number,
	HTRequest *	request));

</PRE>

<H2><A
NAME="c1">HTParseFile: Parse a File through
a file pointer</A></H2>This routine is called by protocols
modules to load an object. uses<A
NAME="z4" HREF="#z3"> HTStreamStack</A>
and <A
NAME="c7" HREF="#c6">HTFileCopy</A> .  Returns HT_LOADED
if succesful, &lt;0 if not.
<PRE>
#if 0
extern int HTParseFile PARAMS((
	HTFormat	format_in,
	FILE		*fp,
	HTRequest *	request));
#endif
</PRE>


<H3>Get next character from buffer</H3>

<PRE>extern int HTInputSocket_getCharacter PARAMS((HTInputSocket* isoc));
</PRE>

<H3>Read block from input socket</H3>Read *len characters and return a
buffer (don't free) containing *len
characters ( *len may have changed).
Buffer is not NULL-terminated.
<PRE>extern char * HTInputSocket_getBlock PARAMS((HTInputSocket * isoc,
						  int *           len));

extern char * HTInputSocket_getLine PARAMS((HTInputSocket * isoc));
extern char * HTInputSocket_getUnfoldedLine PARAMS((HTInputSocket * isoc));
extern char * HTInputSocket_getStatusLine PARAMS((HTInputSocket * isoc));
extern BOOL   HTInputSocket_seemsBinary PARAMS((HTInputSocket * isoc));

#endif

</PRE>

End of definition module

</BODY>
</HTML>
